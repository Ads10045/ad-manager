<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ads-AI All Banner Sizes Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
        .banner-preview-label {
            position: absolute;
            top: -12px;
            left: 20px;
            background: #0f172a;
            color: white;
            padding: 6px 16px;
            border-radius: 999px;
            font-size: 10px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            z-index: 50;
            white-space: nowrap;
        }
        .size-badge {
            background: #3b82f6;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 700;
            margin-left: 8px;
        }
    </style>
</head>
<body class="bg-slate-100 p-8 flex flex-col items-center min-h-screen font-sans pb-20">

    <div class="max-w-[1400px] w-full">
        <header class="mb-16 text-center">
            <h1 class="text-5xl font-black text-slate-900 mb-4 uppercase tracking-tighter italic">üé® All Banner Sizes</h1>
            <p class="text-slate-500 font-medium mb-6">Test complet de tous les formats standards (Digital + Print)</p>
            <div class="flex flex-wrap justify-center gap-4 text-[10px] font-bold uppercase tracking-widest text-slate-400">
                <span>üì± Mobile</span>
                <span>üíª Web</span>
                <span>üìò Facebook</span>
                <span>üñºÔ∏è Roll-Up</span>
                <span>üè∑Ô∏è Vinyl</span>
            </div>
        </header>

        <div class="space-y-20">

            <!-- ============================================ -->
            <!-- SECTION 1: DIGITAL FORMATS -->
            <!-- ============================================ -->
            <div>
                <h2 class="text-2xl font-black text-slate-900 uppercase tracking-tight mb-8 border-b-4 border-blue-500 pb-4 inline-block">üì° Formats Digitaux</h2>
                
                <div class="space-y-12">
                    
                    <!-- 1. FACEBOOK 1200x630 -->
                    <section class="relative">
                        <div class="banner-preview-label">Facebook / Open Graph<span class="size-badge">1200√ó630</span></div>
                        <div class="bg-white p-4 rounded-[2rem] shadow-xl border border-slate-200 overflow-x-auto">
                            <div id="banner-facebook" class="ads-ai-banner" data-path="catalog/facebook-1200x630.html">
                                <div class="w-[1200px] h-[630px] flex items-center justify-center bg-slate-50 rounded-xl animate-pulse">
                                    <span class="text-slate-300 font-black uppercase text-xs tracking-widest">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- 2. LEADERBOARD 728x90 -->
                    <section class="relative">
                        <div class="banner-preview-label">Web Leaderboard<span class="size-badge">728√ó90</span></div>
                        <div class="bg-white p-4 rounded-[2rem] shadow-xl border border-slate-200 overflow-hidden flex justify-center">
                            <div id="banner-leaderboard" class="ads-ai-banner" data-path="catalog/leaderboard-728x90.html">
                                <div class="w-[728px] h-[90px] flex items-center justify-center bg-slate-50 rounded-lg animate-pulse">
                                    <span class="text-slate-300 font-black uppercase text-xs tracking-widest">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- 3. SIDE BY SIDE: MEDIUM RECT + MOBILE -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                        
                        <!-- Medium Rectangle 300x250 -->
                        <section class="relative">
                            <div class="banner-preview-label">Web Medium Rectangle<span class="size-badge">300√ó250</span></div>
                            <div class="bg-white p-4 rounded-[2rem] shadow-xl border border-slate-200 overflow-hidden flex justify-center">
                                <div id="banner-medium" class="ads-ai-banner" data-path="catalog/medium-rect-300x250.html">
                                    <div class="w-[300px] h-[250px] flex items-center justify-center bg-slate-50 rounded-lg animate-pulse">
                                        <span class="text-slate-300 font-black uppercase text-xs tracking-widest">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Mobile 320x50 -->
                        <section class="relative flex flex-col">
                            <div class="banner-preview-label">Mobile Banner<span class="size-badge">320√ó50</span></div>
                            <div class="bg-white p-4 rounded-[2rem] shadow-xl border border-slate-200 overflow-hidden flex justify-center items-center flex-1">
                                <div id="banner-mobile" class="ads-ai-banner" data-path="catalog/mobile-320x50.html">
                                    <div class="w-[320px] h-[50px] flex items-center justify-center bg-slate-50 rounded-lg animate-pulse">
                                        <span class="text-slate-300 font-black uppercase text-[8px] tracking-widest">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </section>

                    </div>
                </div>
            </div>

            <!-- ============================================ -->
            <!-- SECTION 2: PRINT FORMATS -->
            <!-- ============================================ -->
            <div>
                <h2 class="text-2xl font-black text-slate-900 uppercase tracking-tight mb-8 border-b-4 border-orange-500 pb-4 inline-block">üñ®Ô∏è Formats Impression (Aper√ßu)</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-12">
                    
                    <!-- Roll-Up 85x200 -->
                    <section class="relative">
                        <div class="banner-preview-label">Roll-Up Stand<span class="size-badge">85√ó200 cm</span></div>
                        <div class="bg-white p-4 rounded-[2rem] shadow-xl border border-slate-200 overflow-hidden flex justify-center">
                            <div id="banner-rollup" class="ads-ai-banner" data-path="print/rollup-85x200.html">
                                <div class="w-[170px] h-[400px] flex items-center justify-center bg-slate-50 rounded-lg animate-pulse">
                                    <span class="text-slate-300 font-black uppercase text-[8px] tracking-widest">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Vinyl 90x180 -->
                    <section class="relative">
                        <div class="banner-preview-label">Vinyl Standard<span class="size-badge">90√ó180 cm</span></div>
                        <div class="bg-white p-4 rounded-[2rem] shadow-xl border border-slate-200 overflow-hidden flex justify-center">
                            <div id="banner-vinyl" class="ads-ai-banner" data-path="print/vinyl-90x180.html">
                                <div class="w-[180px] h-[360px] flex items-center justify-center bg-slate-50 rounded-lg animate-pulse">
                                    <span class="text-slate-300 font-black uppercase text-[8px] tracking-widest">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Full Detail (400x600) -->
                    <section class="relative">
                        <div class="banner-preview-label">Vertical Card<span class="size-badge">400√ó600</span></div>
                        <div class="bg-white p-4 rounded-[2rem] shadow-xl border border-slate-200 overflow-hidden flex justify-center">
                            <div id="banner-vertical" class="ads-ai-banner" data-path="catalog/product-card-vertical.html">
                                <div class="w-[400px] h-[600px] flex items-center justify-center bg-slate-50 rounded-lg animate-pulse">
                                    <span class="text-slate-300 font-black uppercase text-xs tracking-widest">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </section>

                </div>
            </div>

        </div>

        <footer class="mt-24 flex flex-col items-center gap-8">
            <button onclick="window.location.reload()" class="bg-slate-900 text-white px-20 py-7 rounded-3xl font-black uppercase text-base tracking-[0.3em] shadow-2xl hover:scale-105 active:scale-95 transition-all">
                üîÑ NOUVEAU PRODUIT AL√âATOIRE
            </button>
            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Toutes les banni√®res sont synchronis√©es sur le m√™me produit</p>
        </footer>
    </div>

    <script>
        (function($) {
            if (!$) return;
            $(document).ready(function() {
                const urlParams = new URLSearchParams(window.location.search);
                const isLocal = urlParams.get('env') === 'local';
                
                const apiConfig = {
                    previewUrl: isLocal 
                        ? 'http://localhost:3001/api/render-preview'
                        : 'https://ad-manager-api.vercel.app/api/render-preview',
                    productsUrl: isLocal
                        ? 'http://localhost:3001/api/products'
                        : 'https://ad-manager-api.vercel.app/api/products'
                };

                if (isLocal) {
                    console.log('Using LOCAL API:', apiConfig);
                } else {
                    console.log('Using PROD API:', apiConfig);
                }

                // 1. FETCH PRODUCTS
                $.ajax({
                    url: apiConfig.productsUrl,
                    method: 'GET',
                    success: function(products) {
                        if (!products || products.length === 0) {
                            console.error('No products found via API');
                            alert('No products found in database.');
                            return;
                        }

                        // 2. PICK RANDOM PRODUCT
                        const randomProduct = products[Math.floor(Math.random() * products.length)];
                        console.log('Selected Product:', randomProduct);

                        // 3. MAP DATA & INJECT INTO DOM
                        // Adapt API fields to Banner fields expectation
                        const bannerData = {
                            id: randomProduct.id,
                            name: randomProduct.name,
                            description: randomProduct.description,
                            price: randomProduct.price,
                            supplierPrice: randomProduct.supplierPrice || (randomProduct.price * 0.7).toFixed(2),
                            margin: randomProduct.margin || "30",
                            imageUrl: randomProduct.imageUrl,
                            category: randomProduct.category,
                            supplier: "Partner Supplier", // Generic fallback as not in DB
                            stock: randomProduct.stock,
                            promoExpiry: randomProduct.expiresAt ? new Date(randomProduct.expiresAt).toLocaleDateString() : "Offre Limit√©e",
                            discountValue: randomProduct.isPromo ? "PROMO" : ""
                        };

                        $('.ads-ai-banner').each(function() {
                            const $banner = $(this);
                            Object.keys(bannerData).forEach(key => {
                                $banner.attr(`data-${key.toLowerCase()}`, bannerData[key]);
                                $banner.data(key, bannerData[key]);
                            });
                        });

                        // 4. LOAD BANNERS
                        loadBanners(apiConfig.previewUrl);
                    },
                    error: function(xhr, status, error) {
                        console.error('Failed to fetch products:', error);
                        // Fallback or Alert
                        alert('Failed to load products from API. Check console.');
                    }
                });

                function loadBanners(apiUrl) {
                    const $containers = $('.ads-ai-banner');
                    $containers.each(function() {
                        const $el = $(this);
                        const path = $el.data('path');
                        if (!path) return;

                        $.ajax({
                            url: `${apiUrl}?path=${path}`,
                            type: 'GET',
                            success: function(html) {
                                let finalHtml = html;
                                const allData = $el.data();
                                Object.keys(allData).forEach(key => {
                                    let value = allData[key];
                                    if(value === undefined || value === null) value = "";
                                    const regex = new RegExp(`\\[${key}\\]`, 'g');
                                    finalHtml = finalHtml.replace(regex, value);
                                });
                                $el.hide().html(finalHtml).fadeIn(800);
                            },
                            error: function(xhr, status, error) {
                                console.error("Ads-AI Injector Error:", error);
                                $el.html(`<div class="p-12 text-center text-red-500 bg-red-50 rounded-[2rem] border border-red-100">
                                    <span class="block font-black text-xl mb-4">FAILED TO LOAD TEMPLATE</span>
                                    <code class="text-xs bg-white px-3 py-2 rounded-lg border border-red-100">${path}</code>
                                </div>`);
                            }
                        });
                    });
                }
            });
        })(window.jQuery);
    </script>

</body>
</html>
