<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test All Catalog Banners</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
        body {font-family: Arial, sans-serif; background:#f0f4f8; padding:2rem;}
        .banner-section {margin-bottom:3rem;}
        .banner-title {font-size:1.2rem; font-weight:bold; margin-bottom:0.5rem;}
        .banner-wrapper {border:1px solid #ccc; padding:1rem; background:#fff;}
    </style>
</head>
<body>
    <h1>ðŸ“¦ Test de toutes les banniÃ¨res du catalogue</h1>
    <div id="banners-container"></div>

    <script>
        $(function(){
            const urlParams = new URLSearchParams(window.location.search);
            const isLocal = urlParams.get('env') === 'local';
            const apiBase = isLocal 
                ? 'http://localhost:3001/api/render-preview?path='
                : 'https://ad-manager-api.vercel.app/api/render-preview?path=';
            
            if (isLocal) {
                console.log(' Using LOCAL API:', apiBase);
                $('body').prepend('<div style="background:orange;color:white;text-align:center;padding:5px;font-weight:bold;">MODE LOCAL ACTIVÃ‰</div>');
            } else {
                console.log(' Using PROD API:', apiBase);
            }
            const bannerFiles = [
                'catalog/facebook-1200x630.html',
                'catalog/leaderboard-728x90.html',
                'catalog/medium-rect-300x250.html',
                'catalog/mobile-320x50.html',
                'catalog/product-card-vertical.html',
                'catalog/product-full-detail.html',
                'evenements/pro-expo-banner.html'
            ];

            const $container = $('#banners-container');
            bannerFiles.forEach(function(path){
                const id = path.replace(/[^a-z0-9]/gi, '_'); // safe id
                const $section = $(
                    `<div class="banner-section">
                        <div class="banner-title">${path}</div>
                        <div id="${id}" class="ads-ai-banner" data-path="${path}"></div>
                    </div>`
                );
                $container.append($section);
                const $bannerDiv = $section.find('#' + id);
                $bannerDiv.load(apiBase + encodeURIComponent(path), function(resp, status, xhr){
                    if(status==='error'){
                        console.error('Failed to load', path, ':', xhr.status, xhr.statusText);
                        $bannerDiv.html('<p style="color:red;">Error loading banner</p>');
                    } else {
                        console.log('Loaded', path);
                    }
                });
            });
        });
    </script>
</body>
</html>
