<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test API â€“ Banner by ID</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<style>
        body {font-family: Arial, Helvetica, sans-serif; background:#f5f7fa; padding:2rem;}
        h1 {margin-bottom:1rem;}
        pre {background:#fff; padding:1rem; border:1px solid #ccc; overflow:auto;}
        .error {color:red;}
        .banner-html {margin-top:2rem; border:1px solid #ccc; padding:1rem; background:#fff;}
    </style>
</head>
<body>
    <h1>ðŸ”Ž Test API â€“ RÃ©cupÃ©ration dâ€™une banniÃ¨re par ID</h1>
    <p>Banner ID : <code>0bedda17-8d77-4085-86b6-21a97569c0ff</code></p>
    <button id="loadBtn">Charger la banniÃ¨re</button>
    <div id="result" style="margin-top:1rem;"></div>
    <div id="bannerHtml" class="banner-html"></div>

    <script>
        $(function(){
            const bannerId = "0bedda17-8d77-4085-86b6-21a97569c0ff";
            const apiUrl = `http://localhost:3001/api/banners/${bannerId}`; // change to prod URL if needed
            $('#loadBtn').on('click', function(){
                $('#result').html('<p>Chargementâ€¦</p>');
                fetch(apiUrl, { headers: { 'Accept': '*/*' } })
                    .then(resp => {
                        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
                        return resp.json();
                    })
                     .then(data => {
                         const pretty = JSON.stringify(data, null, 2);
                         $('#result').html('<pre>' + pretty + '</pre>');
                         if (data.path) {
                             $('#bannerHtml').html('<p>Chargement du HTMLâ€¦</p>');
                             fetch(data.path)
                                 .then(r => {
                                     if (!r.ok) throw new Error(`HTTP ${r.status}`);
                                     return r.text();
                                 })
                                 .then(html => {
                                     // Inject product1 data placeholders into the loaded HTML
                                     let finalHtml = html;
                                     Object.keys(data).forEach(key => {
                                         if (key.startsWith('product1')) {
                                             const regex = new RegExp(`\\[${key}\\]`, 'g');
                                             finalHtml = finalHtml.replace(regex, data[key]);
                                         }
                                     });
                                     $('#bannerHtml').html(finalHtml);
                                 })
                                 .catch(err => {
                                     console.error(err);
                                     $('#bannerHtml').html('<p class="error">Erreur de chargement du HTML : ' + err.message + '</p>');
                                 });
                         }
                     })
                    .catch(err => {
                        console.error(err);
                        $('#result').html('<p class="error">Erreur : ' + err.message + '</p>');
                    });
            });
        });
    </script>
</body>
</html>
