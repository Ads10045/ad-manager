<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Banner Real API Example</title>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Config (via CDN for external access) -->
    <script src="https://cdn.jsdelivr.net/gh/Ads10045/ad-manager@main/shared/config.js?v=202601071234"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; margin: 0; padding: 20px; }
        .wrapper { max-width: 800px; margin: 0 auto; }
        .loading-placeholder { height: 90px; background-color: #e2e8f0; border-radius: 4px; animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body>

    <div class="wrapper">
        <div id="banner-container" class="loading-placeholder"></div>
    </div>

    <script>
        $(document).ready(function() {
            /**
             * Script jQuery pour générer une bannière 728x90 (Vanilla CSS)
             * avec des VRAIS produits depuis l'API.
             */

            // 1. Appel AJAX pour récupérer les produits
            $.ajax({
                url: AdsAIConfig.api.getUrl(AdsAIConfig.api.endpoints.products),
                method: 'GET',
                success: function(products) {
                    // Inject Font si nécessaire
                    if (!$('link[href*="fonts.googleapis.com/css2?family=Inter"]').length) {
                        $('head').append('<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">');
                    }

                    if (!products || products.length === 0) {
                        $('#banner-container').html('<p style="color:red; text-align:center;">Aucun produit trouvé.</p>');
                        return;
                    }

                    // 2. Sélectionner 3 produits
                    const selectedProducts = products
                        .sort(() => 0.5 - Math.random())
                        .slice(0, 3);

                    renderBanner(selectedProducts);
                },
                error: function(err) {
                    console.error("Erreur API:", err);
                    $('#banner-container').html('<p style="color:red; text-align:center;">Erreur de chargement API.</p>');
                }
            });

            // 3. Fonction de rendu (Vanilla CSS + Inline Styles)
            function renderBanner(products) {
                
                // Style Block (Scoped as much as possible with prefix)
                const styleBlock = `
                <style>
                    /* Reset partiel */
                    .ads-banner-root * { box-sizing: border-box; margin: 0; padding: 0; }
                    .ads-banner-root img { display: block; max-width: 100%; height: auto; }
                    
                    /* Container */
                    .ads-banner-root {
                        width: 728px;
                        height: 90px;
                        background-color: #0f172a; /* Slate 900 */
                        display: flex;
                        position: relative;
                        overflow: hidden;
                        border: 1px solid #334155; /* Slate 700 */
                        font-family: 'Inter', sans-serif;
                        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
                    }

                    /* Background Effects */
                    .ads-bg-glow { position: absolute; filter: blur(64px); width: 400px; height: 100%; opacity: 0.1; pointer-events: none; }
                    .ads-glow-blue { top: 0; right: 0; background-color: #2563eb; }
                    .ads-glow-purple { bottom: 0; left: 0; background-color: #9333ea; }
                    .ads-pattern {
                        position: absolute; inset: 0;
                        background-image: url('https://grainy-gradients.vercel.app/noise.svg');
                        opacity: 0.2; pointer-events: none;
                    }

                    /* Sidebar */
                    .ads-sidebar {
                        width: 90px;
                        flex-shrink: 0;
                        display: flex;
                        flex-direction: column;
                        justify-content: center;
                        align-items: center;
                        background-color: rgba(0,0,0,0.2);
                        z-index: 10;
                        border-right: 1px solid rgba(255,255,255,0.05);
                        backdrop-filter: blur(4px);
                    }
                    .ads-brand-text {
                        color: #60a5fa; /* Blue 400 */
                        font-size: 10px;
                        font-weight: 900;
                        text-transform: uppercase;
                        letter-spacing: 0.1em;
                        transform: rotate(-90deg);
                        white-space: nowrap;
                    }

                    /* Product List */
                    .ads-products {
                        flex: 1;
                        display: flex;
                        z-index: 10;
                    }
                    .ads-product-item {
                        flex: 1;
                        display: flex;
                        align-items: center;
                        padding: 8px;
                        gap: 12px;
                        position: relative;
                        overflow: hidden;
                        text-decoration: none;
                        border-right: 1px solid rgba(255,255,255,0.05);
                        transition: background-color 0.2s;
                        cursor: pointer;
                    }
                    .ads-product-item:last-child { border-right: none; }
                    .ads-product-item:hover { background-color: rgba(255,255,255,0.05); }

                    /* Badge */
                    .ads-badge {
                        position: absolute;
                        top: 0; right: 0;
                        background: linear-gradient(to left, #dc2626, #ef4444);
                        color: white;
                        font-size: 9px;
                        font-weight: bold;
                        padding: 2px 6px;
                        border-bottom-left-radius: 4px;
                        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
                        transform: translateY(-100%);
                        transition: transform 0.3s;
                    }
                    .ads-product-item:hover .ads-badge { transform: translateY(0); }

                    /* Image */
                    .ads-img-box {
                        width: 60px; height: 60px;
                        background: white;
                        border-radius: 8px;
                        padding: 4px;
                        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
                        border: 1px solid rgba(255,255,255,0.1);
                        flex-shrink: 0;
                        transition: transform 0.2s;
                        display: flex; align-items: center; justify-content: center;
                    }
                    .ads-product-item:hover .ads-img-box { transform: scale(1.05); }
                    .ads-img-box img { width: 100%; height: 100%; object-fit: contain; mix-blend-mode: multiply; }

                    /* Info */
                    .ads-info {
                        min-width: 0;
                        display: flex; flex-direction: column; justify-content: center;
                        height: 100%;
                    }
                    .ads-title {
                        font-size: 10px;
                        color: #d1d5db; /* Gray 300 */
                        font-weight: 400; /* Regular */
                        line-height: 1.25;
                        margin-bottom: 4px;
                        display: -webkit-box;
                        -webkit-line-clamp: 2;
                        -webkit-box-orient: vertical;
                        overflow: hidden;
                        transition: color 0.2s;
                    }
                    .ads-product-item:hover .ads-title { color: #60a5fa; } /* Blue 400 */
                    
                    .ads-price-row { display: flex; align-items: baseline; gap: 8px; }
                    .ads-price { font-size: 14px; font-weight: 900; color: white; }
                    .ads-old-price { font-size: 9px; color: #6b7280; text-decoration: line-through; }

                    /* Hover Line */
                    .ads-hover-line {
                        position: absolute; bottom: 0; left: 0; width: 100%; height: 4px;
                        background: linear-gradient(to right, #3b82f6, #a855f7);
                        transform: scaleX(0); transform-origin: left;
                        transition: transform 0.2s;
                    }
                    .ads-banner-root:hover .ads-hover-line { transform: scaleX(1); }
                </style>
                `;

                const bannerHTML = `
                    ${styleBlock}
                    <div class="ads-banner-root">
                        
                        <!-- Backgrounds -->
                        <div class="ads-bg-glow ads-glow-blue"></div>
                        <div class="ads-bg-glow ads-glow-purple"></div>
                        <div class="ads-pattern"></div>

                        <!-- Logo -->
                        <div class="ads-sidebar">
                            <span class="ads-brand-text">Ads Manager</span>
                        </div>

                        <!-- Products -->
                        <div class="ads-products">
                            ${products.map(p => {
                                const currentPrice = parseFloat(p.price);
                                const oldPrice = p.supplierPrice ? parseFloat(p.supplierPrice) * 1.4 : currentPrice * 1.3;
                                const discount = Math.round(((oldPrice - currentPrice) / oldPrice) * 100);
                                const imgUrl = p.imageUrl || "https://placehold.co/100x100/333/FFF?text=No+Img";
                                const targetUrl = AdsAIConfig.affiliation.getAffiliatedUrl(p.sourceUrl);

                                return `
                                <a href="${targetUrl}" target="_blank" class="ads-product-item">
                                    <div class="ads-badge">-${discount}%</div>
                                    
                                    <div class="ads-img-box">
                                        <img src="${imgUrl}" alt="${p.name}">
                                    </div>

                                    <div class="ads-info">
                                        <h3 class="ads-title">${p.name}</h3>
                                        <div class="ads-price-row">
                                            <span class="ads-price">${currentPrice}€</span>
                                            <span class="ads-old-price">${oldPrice.toFixed(0)}€</span>
                                        </div>
                                    </div>
                                </a>
                                `;
                            }).join('')}
                        </div>
                        
                        <div class="ads-hover-line"></div>
                    </div>
                `;

                // Injection
                const $container = $('#banner-container');
                $container.removeClass('loading-placeholder').html(bannerHTML).hide().fadeIn();
            }
        });
    </script>
</body>
</html>
