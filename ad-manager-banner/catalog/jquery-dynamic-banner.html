<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Banner Real API Example</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 p-10">

    <!-- Wrapper pour centrer -->
    <div class="max-w-[800px] mx-auto space-y-8">
        <h1 class="text-2xl font-bold text-slate-800 text-center">Bannière Dynamique (API Réele)</h1>
        
        <!-- Conteneur vide pour la bannière -->
        <div id="banner-container" class="shadow-xl mx-auto min-h-[90px] bg-slate-200 rounded animate-pulse"></div>
        
        <div class="text-center">
            <button onclick="window.location.reload()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-full text-sm font-semibold transition-colors">
                Charger d'autres produits
            </button>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            /**
             * Script jQuery pour générer une bannière 728x90
             * avec des VRAIS produits depuis l'API.
             */
            
            // Endpoint API
            const API_URL = 'https://ad-manager-api.vercel.app/api/products';

            // 1. Appel AJAX pour récupérer les vrais produits
            $.ajax({
                url: API_URL,
                method: 'GET',
                success: function(products) {
                    if (!products || products.length === 0) {
                        $('#banner-container').html('<p class="text-red-500 text-center p-4">Aucun produit trouvé.</p>');
                        return;
                    }

                    // 2. Sélectionner 3 produits au hasard
                    const selectedProducts = products
                        .sort(() => 0.5 - Math.random()) // Mélange
                        .slice(0, 3);                    // Prend 3

                    renderBanner(selectedProducts);
                },
                error: function(err) {
                    console.error("Erreur API:", err);
                    $('#banner-container').html('<p class="text-red-500 text-center p-4">Erreur de chargement API.</p>');
                }
            });

            // 3. Fonction de rendu (Template)
            function renderBanner(products) {
                // Dimensions standards Leaderboard: 728x90
                const bannerHTML = `
                    <div class="w-[728px] h-[90px] bg-slate-900 relative flex overflow-hidden border border-slate-700 rounded-none shadow-2xl">
                        
                        <!-- Fond décoratif -->
                        <div class="absolute top-0 right-0 w-[400px] h-full bg-blue-600/10 blur-3xl"></div>
                        <div class="absolute bottom-0 left-0 w-[300px] h-full bg-purple-600/10 blur-3xl"></div>
                        
                        <!-- Pattern Grid (optionnel) -->
                        <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20"></div>

                        <!-- Logo / Branding (colonne gauche) -->
                        <div class="w-[90px] flex-shrink-0 flex flex-col justify-center items-center bg-black/20 z-10 border-r border-white/5 backdrop-blur-sm">
                            <span class="text-blue-400 text-[10px] uppercase font-black tracking-widest -rotate-90 whitespace-nowrap">Ads Manager</span>
                        </div>

                        <!-- Liste des produits -->
                        <div class="flex-1 flex divide-x divide-white/5 z-10">
                            ${products.map(p => {
                                // Calcul d'un "Vieux Prix" fictif si pas fourni pour afficher un rabais
                                const currentPrice = parseFloat(p.price);
                                const oldPrice = p.supplierPrice ? parseFloat(p.supplierPrice) * 1.4 : currentPrice * 1.3;
                                const discount = Math.round(((oldPrice - currentPrice) / oldPrice) * 100);
                                
                                // Fallback image si vide
                                const imgUrl = p.imageUrl || "https://placehold.co/100x100/333/FFF?text=No+Img";

                                return `
                                <div class="flex-1 p-2 flex items-center gap-3 group cursor-pointer hover:bg-white/5 transition-all relative overflow-hidden">
                                    
                                    <!-- Badge Promo -->
                                    <div class="absolute top-0 right-0 bg-gradient-to-l from-red-600 to-red-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded-bl shadow-sm transform translate-y-[-100%] group-hover:translate-y-0 transition-transform duration-300">
                                        -${discount}%
                                    </div>

                                    <!-- Image Produit -->
                                    <div class="w-[60px] h-[60px] bg-white rounded-lg p-1 shadow-sm flex-shrink-0 group-hover:scale-105 transition-transform border border-white/10">
                                        <img src="${imgUrl}" alt="${p.name}" class="w-full h-full object-contain mix-blend-multiply">
                                    </div>

                                    <!-- Info Produit -->
                                    <div class="min-w-0 flex flex-col justify-center h-full py-1">
                                        <h3 class="text-[10px] text-gray-300 font-medium leading-tight mb-1 line-clamp-2 h-[24px] overflow-hidden">${p.name}</h3>
                                        <div class="flex items-baseline gap-2">
                                            <span class="text-sm font-black text-white">${currentPrice}€</span>
                                            <span class="text-[9px] text-gray-500 line-through decoration-gray-500/50">${oldPrice.toFixed(0)}€</span>
                                        </div>
                                    </div>
                                </div>
                                `;
                            }).join('')}
                        </div>
                        
                        <!-- Call to Action (Survol) -->
                        <div class="absolute bottom-0 w-full h-1 bg-gradient-to-r from-blue-500 to-purple-500 transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left"></div>
                    </div>
                `;

                // 4. Injection dans la page
                // On enlève "animate-pulse" et on met le contenu
                const $container = $('#banner-container');
                $container.removeClass('animate-pulse start-slate-200 bg-slate-200 min-h-[90px]').html(bannerHTML).hide().fadeIn();
            }
        });
    </script>
</body>
</html>
